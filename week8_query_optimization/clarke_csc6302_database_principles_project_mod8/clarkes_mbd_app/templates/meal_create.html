{% extends "base.html" %}
{% block title %}Log Meal – MBD Wellness{% endblock %}

{% block hero %}
<section class="section py-3 bg-dark text-white">
  <div class="container">
    <div class="d-flex flex-wrap justify-content-between align-items-center">
      <h1 class="h3 text-uppercase font-weight-bold mb-0">Log a Meal</h1>
      <ol class="breadcrumb mb-0">
        <li class="breadcrumb-item"><a href="{{ url_for('dashboard') }}">Dashboard</a></li>
        <li class="breadcrumb-item active">Meals</li>
      </ol>
    </div>
  </div>
</section>
{% endblock %}

{% block content %}
<section class="section">
  <div class="container">
    <div class="row">

      <!-- left Create meal form -->
      <div class="col-lg-5 my-3">
        <div class="bg-white p-4 shadow-lg">
          <h5 class="text-uppercase font-weight-bold mb-3">New Meal</h5>

          <form method="post" action="{{ url_for('meal_create') }}">
            <div class="form-group">
              <label>Date & Time</label>
              <input type="datetime-local"
                     class="form-control"
                     name="meal_datetime"
                     required
                     value="{{ now_local|default('') }}">
            </div>

            <div class="form-group">
              <label>Meal Type</label>
              <select class="form-control" name="meal_type" required>
                <option value="breakfast">Breakfast</option>
                <option value="lunch">Lunch</option>
                <option value="dinner">Dinner</option>
                <option value="snack">Snack</option>
              </select>
            </div>

            <div class="form-group">
              <label>Notes</label>
              <textarea class="form-control" name="notes" rows="2" required></textarea>
            </div>

            <button class="btn btn-primary btn-block" type="submit">Save Meal</button>
          </form>
        </div>
      </div>

      <!-- right Items table -->
      <div class="col-lg-7 my-3">
        <div class="bg-white p-4 shadow-lg">

          {% if active_meal_id %}
            <div class="d-flex justify-content-between align-items-center mb-3">
              <h5 class="text-uppercase font-weight-bold mb-0">
                Meal Items (Meal ID: {{ active_meal_id }})
              </h5>
              <a class="btn btn-outline-dark btn-sm"
                 href="{{ url_for('meal_add_items', meal_id=active_meal_id) }}">
                Add More Items
              </a>
            </div>
          {% else %}
            <h5 class="text-uppercase font-weight-bold mb-3">Today’s Items</h5>
          {% endif %}

          <div class="table-responsive">
            <table class="table table-striped mb-0">
              <thead>
                <tr>
                  <th>Food</th>
                  <th>Servings</th>
                  <th>Calories/serv</th>
                  <th>Total Calories</th>
                </tr>
              </thead>
              <tbody>
                {% for i in today_items %}
                <tr>
                  <td>{{ i.food_name }}</td>
                  <td>{{ i.servings }}</td>
                  <td>{{ i.calories_per_serving }}</td>
                  <td>{{ i.total_calories }}</td>
                </tr>
                {% else %}
                <tr>
                  <td colspan="4" class="text-muted">
                    {% if active_meal_id %}
                      No items added yet for this meal.
                    {% else %}
                      No food items logged today.
                    {% endif %}
                  </td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>

          {% if active_meal_id %}
            <div class="mt-3">
              <a class="btn btn-link p-0" href="{{ url_for('meal_create') }}">
                ← Back to today’s items
              </a>
            </div>
          {% endif %}

        </div>
      </div>

    </div>
  </div>
</section>
{% endblock %}
